---
title: GGI Format
description: 'A custom binary format for storing model and sprite data'
---

## Overview

```c
typedef struct {
    GGIHeader_t header;
    ModelTable_t model_table;
} GGIData_t;
```

## Header

```c
typedef struct {
    int32_t sprite_group_index_1;
    int32_t sprite_group_index_2_enc;
    int32_t sprite_group_index_3_enc; // fancy numbers / text
    int32_t sprite_group_index_4_enc; // hidden level particles (do not seem affected though)
    int32_t sprite_group_index_5_enc; // bonus meter
    int32_t sprite_group_index_6_enc; // hourglass sprite to the end

    int32_t hourglass_anim_offset_enc; // hourglass spin animation
    int32_t unk_offset1_enc; // block lighting related
    int32_t unk_offset2_enc; // possibly ignored in game, doesn't seem to be read anywhere
    int32_t unk_offset3_enc; // offset to "dummy!!!" text
    int32_t unk_offset4_enc; // ball bounce animation
    int32_t sprites_offset_enc;
    int32_t file_size_enc;
    int32_t entity_table_offset_enc;
    int32_t object_table_offset_enc;
} GGIHeader_t;
```

The first part of the header contain indexes to different groups of sprites:

1. Sprites relating to object collection and teleportation affects.
2. Sprites relating to the sun glare and scores / loading screen blue background boxes.
3. Sprites relating to menu text elements.
4. Sprites relating to the hidden level sky particles, although **does not seem to affect them**.
5. Sprites relating to the bonus level HUD.
6. Sprites relating to the hourglass hud and various other text elements; the rest of the sprites.

```c
sprite_group_index_1 = sprite_group_index_1;
sprite_group_index_2 = sprite_group_index_1 + sprite_group_index_2_enc;
sprite_group_index_3 = sprite_group_index_2 + sprite_group_index_3_enc;
sprite_group_index_4 = sprite_group_index_3 + sprite_group_index_4_enc;
sprite_group_index_5 = sprite_group_index_4 + sprite_group_index_5_enc;
sprite_group_index_6 = sprite_group_index_5 + sprite_group_index_6_enc;
```

Every offset contained in the header is encoded in the following manner for an unknown reason:

```c
hourglass_anim_offset = hourglass_anim_offset_enc * 2 + 0x34;
unk_offset2 = hourglass_anim_offset + unk_offset2_enc * 2;
unk_offset3 = unk_offset2 + unk_offset3_enc * 2;
unk_offset4 = unk_offset3 + unk_offset4_enc * 2;
unk_offset5 = unk_offset4 + unk_offset5_enc * 2;
sprites_offset = unk_offset5 + sprites_offset_enc * 2;
file_size = sprites_offset + file_size_enc * 2;

entity_table_offset = ((entity_table_offset_enc >> 2) + 0xD) * 4;
object_table_offset = ((object_table_offset_enc >> 2) + 0xD) * 4;
```

## Model Table

<Expandable title="structure">
    ```c
    typedef struct {
        // entities
        ModelEntry_Entity_t world_balls[10];
        ModelEntry_Entity_t bonus_balls[3];
        ModelEntry_Entity_t hidden_ball;
        ModelEntry_Entity_t padding[6];
        ModelEntry_Entity_t slow_star;
        ModelEntry_Entity_t tire;
        ModelEntry_Entity_t fast;
        ModelEntry_Entity_t capture_pod;
        ModelEntry_Entity_t captivator;

        // objects
        ModelEntry_Variants_t padding[5];
        ModelEntry_Variants_t transporters;
        ModelEntry_Variants_t padding;
        ModelEntry_Variants_t exits;
        ModelEntry_Variants_t padding[2];
        ModelEntry_Variants_t buttons;
        ModelEntry_Variants_t bounce_pad;
        ModelEntry_Variants_t moving_spike;
        ModelEntry_Variants_t spike;
        ModelEntry_Variants_t padding[13];
        ModelEntry_Variants_t hidden_exit;
        ModelEntry_Variants_t fruit_bowl;
        ModelEntry_Variants_t arrow;
        ModelEntry_Variants_t padding[2];
        ModelEntry_Variants_t key;
        ModelEntry_Variants_t lethargy_pill;
        ModelEntry_Variants_t bounce_pill;
        ModelEntry_Variants_t invincibility_pill;
        ModelEntry_Variants_t hourglass;
        ModelEntry_Variants_t gems;
        ModelEntry_Variants_t coins;
        ModelEntry_Variants_t sunglasses;
        ModelEntry_Variants_t present_1;
        ModelEntry_Variants_t present_2;
        ModelEntry_Variants_t present_3;
        ModelEntry_Variants_t hedgehog;
        ModelEntry_Variants_t apple;
        ModelEntry_Variants_t watermelon;
        ModelEntry_Variants_t pumpkin;
        ModelEntry_Variants_t banana;
        ModelEntry_Variants_t strawberry;
        ModelEntry_Variants_t unknown;
        ModelEntry_Variants_t unknown;
    } ModelTable_t;

    typedef struct {
        int32_t lod_offset_1;
        int32_t lod_offset_2;
        int32_t lod_offset_3;
        int32_t padding; // a 4th LOD offset is available in demos
    } ModelEntry_Entity_t; // 0x10 bytes

    typedef struct {
        typedef struct {
            int32_t variant1_Loffset;
            int32_t variant2_Loffset;
            int32_t variant3_Loffset;
            int32_t variant4_Loffset;
        } Variant_LOD_offset_t;

        Variant_LOD_offset_t L1;
        Variant_LOD_offset_t L2;
        Variant_LOD_offset_t L3;
        int32_t padding[4];
    } ModelEntry_Variants_t; // 0x40 bytes
    ```

</Expandable>

The model offset table begins at offset **$3C** in the file and is where the game references each object's model. Every model has **three** different levels of detail (LOD), with the first being the **highest quality** when the player is closest to the model, and the third being the **lowest quality** when the player is further from the model. Every entry in the table contains offsets to these different quality models, with each offset being denoted with an "L" in the structure above.

Padding between entries in the table are always set to **-1**.

The last two entries in the table most likely refer to the last two unused presents in the demo.

Each offset is **relative** to a specific offset:

-   Entity offsets are relative from **0x3C**.
-   Object offsets are relative from **0x1CC**.

## Model Data

```c
typedef struct {
    short unknown;
    short unknown;
    short unknown;
    short unknown;
    short stp_blend_operator;
    short unknown;
    int32_t unknown; // set to 24 for objects, 28 for balls
    IndexBuffer_t index_buffer;
    VertexBuffer_t vertex_buffer;
} ModelData_t;

typedef struct {
    int32_t size;
    int32_t unknown;
    char indices[size - 32];
    int32_t unknown = 1;
    int32_t unknown = 0;
} IndexBuffer_t;

typedef struct {
    typedef struct {
        short x1;
        short y1;
        short x2;
        short y2;
        short x3;
        short y3;
        short z1;
        short z2;
        short z3;
        short padding = 0;
    } VertexBuffer_Group_t;

    int32_t vertexBufferCount = 1; // vertex buffer count (32 for moving spike)
    int32_t size; // size of vertices section
    VertexBuffer_Group_t vertices[][];
} VertexBuffer_t;

typedef struct {
    typedef struct {
        char r;
        char g;
        char b;
        char vFlags;
    } VertexColor_t; // 4 bytes

    int32_t unknown = 1;
    int32_t size; // size of vertex colors section
    VertexColor_t vertex_colors[size / 4];
} VertexColors_t;
```

Not every model in the game has a vertex count in multiples of three. Since the vertex position buffer of a model is grouped into **threes**, the leftover vertex positions are set to **0**. For example, the _arrow model_.

### Vertex Flags

Each vertex color attribute contains an extra byte with flags that specifies additional information about the vertex (vFlags):

| Bit | Type               |
| --- | ------------------ |
| 1   | Unused (0)         |
| 2   | Unused (0)         |
| 3   | Unused (1)         |
| 4   | Unknown            |
| 5   | Tri (0) / Quad (1) |
| 6   | Unused (0)         |
| 7   | Transparent        |
| 8   | Unused (0)         |
